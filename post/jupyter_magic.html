<html lang="en">
    <head>
      <title>Deniz's personal pages</title>
      <meta charset="utf-8">
      <meta name="viewport" content="initial-scale=1">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css" integrity="sha384-zTROYFVGOfTw7JV7KUu8udsvW2fx4lWOsCEDqhBreBwlHI4ioVRtmIvEThzJHGET" crossorigin="anonymous">
      <script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.js" integrity="sha384-GxNFqL3r9uRJQhR+47eDxuPoNE7yLftQM8LcxzgS4HT73tp970WS/wV5p8UzCOmb" crossorigin="anonymous"></script>
      
      <link rel="stylesheet" href="/css/style.css" />
      <!--script src="/js/vendor/es5-shim.min.js"></script>
      <script src="/js/vendor/ansi_up.min.js"></script>
      <script src="/js/vendor/prism.min.js"></script>
      <script src="/js/vendor/katex.min.js"></script>
      <script src="/js/vendor/katex-auto-render.min.js"></script>
      <link rel="stylesheet" href="/css/vendor/katex.min.css" />
      <link href="https://fonts.googleapis.com/css?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,300;1,400;1,500;1,700;1,900|Roboto+Mono:300,300i,400,400i,500,500i,700,700i&amp;display=swap" rel="stylesheet"-->
    </head>
    <body>
        <div>
        <strong>
        <a href="/micro/micro-index.html" onClick="this.href+='?rnd='+new Date().getTime()">Micro</a> | 
        <a href="/post/index.html" onClick="this.href+='?rnd='+new Date().getTime()">Macro</a> | 
        <a href="/post/about.html">About</a> |
        <a href="/post/now.html">Now</a> |
        <a href="/twtxt.txt">twtxt</a>
        </strong>
        </div>
        <hr />
        <div id="main">
        <h1 id="title"> Jupyter notebook custom magic</h1>
        <div id="date"><em> 2021-09-01</em></div>
        <div class="content">
        <p>Jupyter notebooks a great way of prototyping small programs and exploring/visualizing data from scripts. I use them to run back tests on trading algos. One of the most power features is that you can actually pipe the contents of a cell to another python function. This feature came in really handy when I wanted to pipe a trading algo into my backtesting framework. To accomplish this you need to make use of &quot;magics&quot;</p>
<p>First create a function in your <code>__init__.py</code> file in your package</p>
<pre><code>def load_ipython_extension(ipython):
        def rtrade(line, cell):
            parser = argparse.ArgumentParser()
            parser.add_argument(&quot;-s&quot;, help=&quot;start date YYYY-mm-dd&quot;, dest=&quot;start&quot;,
                    action=&quot;store&quot;, required=False)
            parser.add_argument(&quot;-e&quot;, help=&quot;end date YYYY-mm-dd&quot;, dest=&quot;end&quot;,
                    action='store', required=False)
            parser.add_argument(&quot;-o&quot;, help=&quot;result output file name&quot;, dest=&quot;output&quot;,
                    action='store', required=False, default=&quot;result_df.pickle&quot;)
            # We create a string buffer containing the
            # contents of the cell.
            args = parser.parse_args(line.split())
            sio = StringIO(cell)
            print(&quot;dates&quot;,args.start)
            print(&quot;end&quot;, args.end)
            return Simulator(args.start, args.end, args.output).test(cell)
        ipython.register_magic_function(rtrade, &quot;line_cell&quot;, &quot;rtrade&quot;)
</code></pre>
<p>when we load the extension Jupyter will execute this function for us. The line parameter is the line of the magic function and the cell parameter is the contents of the cell.</p>
<p>Load the extension with (my package is called retrotrade)</p>
<pre><code>%load_ext retrotrade
</code></pre>
<p>now execute the magic with</p>
<pre><code>%%rtrade -s 2020-01-01 -e 2021-01-01 -o result.pickle

&lt;some python code&gt;
</code></pre>
<p>The line parameter above will contain the first line that starts with <code>%%</code> and the cell parameter will contain the rest of the cell contents.</p>

        </div>
        </div>
    </body>
</html>
