<!DOCTYPE html>
<html lang="en">
    <head>
      <title>Deniz's personal pages</title>
      <meta charset="utf-8">
      <meta name="viewport" content="initial-scale=1">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.css" integrity="sha384-zTROYFVGOfTw7JV7KUu8udsvW2fx4lWOsCEDqhBreBwlHI4ioVRtmIvEThzJHGET" crossorigin="anonymous">
      <script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/katex.min.js" integrity="sha384-GxNFqL3r9uRJQhR+47eDxuPoNE7yLftQM8LcxzgS4HT73tp970WS/wV5p8UzCOmb" crossorigin="anonymous"></script>
      <script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.18/dist/contrib/auto-render.min.js" integrity="sha384-vZTG03m+2yp6N6BNi5iM4rW4oIwk5DfcNdFfxkk9ZWpDriOkXX8voJBFrAO7MpVl" crossorigin="anonymous"
           onload="renderMathInElement(document.body);"></script>
    </head>
    <body>
        <div>
        <strong>
        <a href="/micro/micro-index.html" onClick="this.href+='?rnd='+new Date().getTime()">Micro</a> | 
        <a href="/post/index.html" onClick="this.href+='?rnd='+new Date().getTime()">Macro</a> | 
        <a href="/post/about.html">About</a> |
        <a href="/post/now.html">Now</a> |
        <a href="/twtxt.txt">twtxt</a>
        </strong>
        </div>
        <hr />
        <div id="main">
        <h1 id="title"> TechScan DevLog 2018-10-10</h1>
        <div id="date"><em> 2018-10-10</em></div>
        <div class="content">
        <p><strong>summary</strong></p>
<ul>
<li>stuff done in September 2018</li>
<li>Jenkins automation</li>
<li>persistence problems</li>
<li>return to single thread mode</li>
<li>scan refactoring and parameter change support</li>
<li>scan performance improvements</li>
<li>java 10 adventures</li>
<li>parameter recommendation tests</li>
<li>hybrid client developments</li>
</ul>
<p>Wow, September was a month that I would only describe as “I lost my humanity
and became a beast”. After checking the git commit logs I see 480 new commits,
touching 26410 lines for the API and Engine, which is quite a bit. There is
basically too much stuff that I have done to cover in detail so I’ll just have
to go over the most import changes for this month.</p>
<p>First off I want to start with the automation tasks. I was running the BFX, IEX
sync tasks, scanner tasks via crontab on the test machine. This was OK for some
time, but it wasn’t getting notifications about failed jobs or any information
about the task duration. So I moved all these periodic engine tasks to Jenkins.
Another added bonus is it’s way easier to manage the task pipeline (which task
should run after which task, which can run in parallel) from Jenkins rather
than a bunch of ad-hoc shell scripts. I also changed the development cycle from
committing code to master to committing first into a development branch, and
then asking Jenkins via Hubbot through slack to test and merge and push the
changes. This keeps the master branch at a stable state all the time. G.
requested that any pushes to the master branch of the web client repository be
deployed immediately so I had to do some GitLab trickery to get that working,
as GitLab doesn’t allow that for unpaid accounts. But it can be done via web
hooks.</p>
<p>The current flow of crons are looking like this</p>
<p><em>lost image</em></p>
<p>Using spring boot is a MUST if you are developing with Java – the advantages it
provides are countless, but it does come with it’s own quirks. I had been
getting “transaction manage not found – cannot remove entity” errors on some of
the data sync services. The solutions on the internet were all about adding a
transactional annotation to the service method and people had accepted those
answers. But I guess something changed along the way in spring development as
they did not work for me. The solution is was to add the annotation to the
repository interface. Sometimes something so simple can eat up a lot of
precious development time, but it’s satisfying in the end when you solve it. As
I was fiddling around with this I also decided to save the response JSON from
the providers instead of parsing them into domain entities and saving those.
Now instead of having 1 M daily data points, I have 8 K key value items and I
process them in memory. I was caching the domain objects anyways so this spares
some extra load on the database.</p>
<p>During development I wanted to get the engine results as fast as possible so I
was parallelizing all the operations in the engine. I noticed along the way
that “parallelStream” is not the answer to all of the question. I ran into
cases where parallelizing would really screw up the cache, and serial
processing with a good cache usage is way better (in terms of efficiency) than
just using all the cores. I can get more bang for a core than I could when the
processing was done in parallel. This decision was also in part due to the fact
that I want to run the engine on the same machine as the API (yes, I am
basically poor) and I can’t have the engine hogging all the CPU and exhausting
RAM. I can’t also have the entire data set in memory (or most of it) and this
tends to happen when threads are running at the same time. So with the serial
processing using the cache in an optimal way, the scanning process takes 2.5 K
seconds on a single core. Running in parallel took 600 seconds on 8 cores.</p>
<p>A prerequisite to serialize the scanners was to improve their performance. I
installed the excellent YourKit profiler trail version (which by the way is
very expensive – otherwise I would buy it) and tracked down the bottle necks to
unnecessary object wrapping (using my own SuperList class with convenience
methods for accessing elements, like getLast(N), getTail(..), etc.) and the
parsing of string to dates and vice versa. After hunting these down and
refactoring the code to get rid of extra layers and work, there was a 3x
increase in speed which brings the processing time to acceptable limits.</p>
<p>An integral part of the system is the performance evaluator for scans based on
past performance. I had coded this in a hurry and it was a bit disgusting, so I
refactored this into it’s own service. The functionality is the same but it’s
simplified and runs a bit faster.</p>
<p>I hate the verbosity of Java so I thought I’d look into what was going on in
the Java world, which I hadn’t done since the release of Java 8 and the
streaming API. I found out that Java 10 was released March 2018 and finally had
support for the “var” keyword, which meant less verbosity in assignments. I
know it’s kind of trivial but I wanted to give it a go, since spring boot it
supposed to support Java 10. So I went ahead and updated the development and
test environments to Java 10 and compiled the code. A couple of warnings of
unsafe access in spring but otherwise everything seemed OK. That is until I
tried running the API. Then a lot of exceptions about Redis not being happy
with something (which I don’t remembers, and could not find an easy solution
for), so I reverted back to 8, which is way more stable. I have long lines of
code, but at least everything works correctly</p>
<p><img src="/img/1-m79Makp8mOHomhro.png" alt="" /></p>
<p>A great Idea that I had for the engine was parameter optimizations. RSI
oversold is 80, but why? why not 60?</p>
<p>I guess the guy who invented it had success with 80 and kept it as a default
and now everybody uses that. But wouldn’t it be great if I could figure out the
optimal number by scanning the past RSI turning points? That’s what parameter
optimization/recommendation is about. There are a LOT of combinations to
calculate so this feature has to be selective on the symbols and the parameter
values that it tries. I still have to bake this idea, but I did put down a PoC
service that does this.</p>
<p>I also started with the mobile client development using PhoneGap and Framework
7 with Vue.js. Vue.js is pretty amazing – at last someone has come up with a
good framework for JavaScript development. I used to be a Mithril person but
the lack of templating and using that m() function was a bit annoying. Also the
component system in Mithril is complicated and not easy as Vue.js. Framework7
looks OK’ish but there are some quirks with it too. I ran into a problem with
the router, that would break the back button randomly. It’s surprisingly
difficult to find answers to question – I guess they don’t have a large
community so I’ll probably drop F7 in favor Vuetify.</p>
<p>That was a long post, but I guess this is how it’s gonna be if I do it monthly.
I still want to do a write up about the team dynamics, and the frustration that
I’m having with that.</p>

        </div>
        </div>
	<footer>
	<em>generated on 2021-09-28 17:08:54</em>
	</footer>
    </body>
</html>
