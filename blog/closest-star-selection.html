<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Deniz's personal pages</title>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1">
        <script src="/js/vendor/es5-shim.min.js"></script>
        <script src="/js/vendor/marked.min.js"></script>
        <!--script src="/js/vendor/purify.min.js"></script-->
        <script src="/js/vendor/ansi_up.min.js"></script>
        <script src="/js/vendor/prism.min.js"></script>
        <script src="/js/vendor/katex.min.js"></script>
        <script src="/js/vendor/katex-auto-render.min.js"></script>
	<script src="/js/vendor/notebook.js?_=2021-08-29 20:22:09"></script>
        <link rel="stylesheet" href="/css/vendor/katex.min.css" />
        <link rel="stylesheet" href="/css/vendor/prism.css" />
	<link rel="stylesheet" href="/css/notebook.css?2021-08-29 20:22:09" />
	<link rel="stylesheet" href="/css/nbpreview.css?2021-08-29 20:22:09" />
  <link href="https://fonts.googleapis.com/css?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,300;1,400;1,500;1,700;1,900|Roboto+Mono:300,300i,400,400i,500,500i,700,700i&amp;display=swap" rel="stylesheet">
        <script type="application/text" id="source">
          {"cells": [{"cell_type": "markdown", "metadata": {}, "source": ["# k closest star selection\n", "", "2018-05-09 [#programming](/tag/programming.html) [#gamedev](/tag/gamedev.html)\n"]}, {"cell_type": "markdown", "metadata": {"tags": ["programming", "gamedev"]}, "source": ["\n", "In my post about generation galaxy warp lanes [GalaxyWarpLaneGeneration][1] I talked about the a naive method that would select the N closest stars to a given star. \n", "Even though the name states the method as naive it isn't such a naive tasks when you consider large amounts of stars. For a game the number of stars could be in the \n", "hundreds or maybe thousand, but what if for a minute we actually consider the real world? How could you select N closest start from 10M star? or 100M maybe even a 1B? \n", "\n", "My initial though was the simple approach: calculate the distance between the source and each of the other stars, and sort the other star list on this distance. \n", "This results in an O(nlogn) algorithm which is the best a sort on this type of randomized data. But there is a better way: The key is we don't need to \n", "sort all the list, we are just looking to get the closest N elements. The algorithm is as follows:\n", "\n", "1. create a MAX heap of size N\n", "2. add the first N stars from the list to the heap, based on a distance comparator from the source star.\n", "3. for the remaining stars in the list:\n", "     1. if the distance to that star is less than the top of the heap, remove the top and add this star.\n", "4. get all the element in the heap for the result.\n", "\n", "```\n", "public List<Star> closest(List<Star> stars, int n) {\n", "    PriorityQueue<Pair<Star,Double>> heap = new PriorityQueue<>(n, \n", "       (x1, x2) -> x2.getSecond().compareTo(x1.getSecond()));\n", "\n", "    for (int i =0;i<n;i++) {\n", "        heap.add(new Pair<>(stars.get(i), distance(stars.get(i))));\n", "    }\n", "    for(int i=n;i<stars.size();i++) {\n", "        if(stars.get(i) == this) continue;;\n", "        double distance = distance(stars.get(i));\n", "        if (distance < heap.peek().getSecond()) {\n", "            heap.poll();\n", "            heap.add(new Pair<>(stars.get(i), distance));\n", "        }\n", "    }\n", "    return heap.stream().map(Pair::getFirst).collect(toList());\n", "}\n", "```\n", "\n", "we are adding (N-k) element to a heap of k element. Each insertion will cost log(k). So the total will be o(N * logK)\n", "I am usually connecting 2 or 3 stars which result in 1000 * log2 which is around 300 operations vs. 1000 * log(1000) which is also 300 operations.\n", "It doesn't make a difference for the basic case. But if I had 10M start then 10M * log2 = 3M vs 10M * log10M = 70M\n", "it does make a difference.\n", "\n", "[1]: /code/galaxy-hyper-lane-generation/\n"]}], "metadata": {"celltoolbar": "Tags", "kernelspec": {"display_name": "Python 3", "language": "python", "name": "python3"}, "language_info": {"codemirror_mode": {"name": "ipython", "version": 3}, "file_extension": ".py", "mimetype": "text/x-python", "name": "python", "nbconvert_exporter": "python", "pygments_lexer": "ipython3", "version": "3.6.12"}}, "nbformat": 4, "nbformat_minor": 4}
        </script>
    </head>
    <body>
        <div id="main">
            <div class="header">
            <div style="position: absolute; left:10px; top:5px;">
              <a href="/blog/about.html">about</a>
              <a href="/micro/micro.html">micro</a>
              <a href="/blogindex.html">macro</a>
            </div>
            <h1>Deniz's Weblog</h1>
            <p style="font-family: monospace;">
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
            </p>
            </div>
            <div id="notebook-holder"></div>
            <hr/>
            <div>
              <em>Generated on 2021-08-29 20:22:09</em>
            </div>
            <p>
              Questions or comments? Please take the time to compose an email and send it to <a href="mailto:deniz.dizman@gmail.com?subject=Question/Comment">me</a>.
              I will update the relevant page with our correspondence.
            </p>
        </div>
        <script>
          var src = document.getElementById("source");
          var notebook = nb.parse(JSON.parse(src.innerText));
          var rendered = notebook.render();
          document.getElementById("notebook-holder").appendChild(rendered);
        </script>
    </body>
</html>
