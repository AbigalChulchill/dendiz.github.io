<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Deniz's personal pages</title>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1">
        <script src="/js/vendor/es5-shim.min.js"></script>
        <script src="/js/vendor/marked.min.js"></script>
        <!--script src="/js/vendor/purify.min.js"></script-->
        <script src="/js/vendor/ansi_up.min.js"></script>
        <script src="/js/vendor/prism.min.js"></script>
        <script src="/js/vendor/katex.min.js"></script>
        <script src="/js/vendor/katex-auto-render.min.js"></script>
	<script src="/js/vendor/notebook.js?_=2021-09-09 14:31:00"></script>
        <link rel="stylesheet" href="/css/vendor/katex.min.css" />
        <link rel="stylesheet" href="/css/vendor/prism.css" />
	<link rel="stylesheet" href="/css/notebook.css?2021-09-09 14:31:00" />
	<link rel="stylesheet" href="/css/nbpreview.css?2021-09-09 14:31:00" />
  <link href="https://fonts.googleapis.com/css?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,300;1,400;1,500;1,700;1,900|Roboto+Mono:300,300i,400,400i,500,500i,700,700i&amp;display=swap" rel="stylesheet">
        <script type="application/text" id="source">
          {"cells": [{"cell_type": "markdown", "metadata": {}, "source": ["# navigation order processing\n", "", "2017-12-17 [#hexarategy](/tag/hexarategy.html) [#gamedev](/tag/gamedev.html)\n"]}, {"cell_type": "markdown", "metadata": {"tags": ["hexarategy", "gamedev"]}, "source": ["\n", "Having ships is useless if you can\u2019t boss them around the grid. So how would you do that, be also allowing multiple ships to move at any given time without running into each other? The first iteration of the path finder was the rasterized path finder I explained here. This method will provide a list of cells that the ship must travel through (I since have added a new algorithm that takes into account any obstacles in the way. It just returns a different list of cells which isn\u2019t of any significance for the navigation command system). When the user clicks on a ship, we need to store that clicked cell and it\u2019s ship into a temporary variable. The first click will also highlight the possible cells the ship can navigate to. The post about cells in range explains how there are calculated. The second time the user clicks on a cells, it can mean 3 things\n", "\n", "1. the user wants to navigate to a cell\n", "1. the user wants to cancel the selection\n", "1. the user wants to select another ship from his fleet\n", "1. the user wants to attack an enemy ship\n", "\n", "We will address the first 3 items. Items 2 and 3 are simple so let\u2019s get them out of the way first. If the user wants to cancel the selection, he just clicks on a cell not highlighted by the cells in range call. We just need to check if the clicked cell is in the list returned from this call. If not reset the variable that holds the clicked ship to return to the initial state. If the user wants to select another ship to move, if has clicked on a cell with one of his ships. Since he can\u2019t attack that ship, just check if the clicked cell has a ship on it and if that ship belongs to the player. If true, set the selected cell to that one.\n", "\n", "Here is an image of a state machine that shows to transitions and states\n", "\n", "![](/img/nop.jpg)\n", "\n", "The red transition is cancelling the selection, and the green transition is selecting another ship to navigate.\n", "\n", "Now let\u2019s explore the case where the user wants to navigate to a cell. We need \n", "to support multiple ships wandering around at the same time, so the user doesn\u2019t\n", "have to wait for the first ship to arrive before issuing a second order.\n", "This means we need a queue of navigation orders that will be processed at each\n", "update. We create an object that will store the source cell, target cell, the\n", "path the ship will take and the ship model and the ship object that carries meta\n", "data associated with the ship. At each update call we will process each item in \n", "the command queue and make the required movement to the next cell in the path. \n", "After each item in the queue is processed it gets queued again. This way all the \n", "ships movements will be updated once for every update call. If there is another \n", "ship in the next cell for the ship we are processing just skip that command item \n", "for this frame. This will make the current ship wait if there is another ship \n", "blocking the path, until the ship moves away from that cell. There is an edge \n", "case that needs to handled here, which is that if the blocking ships final cell\n", "is that cell, then the current ship will wait forever. To mitigate this case \n", "checking if any ships will end up at a cell blocking the way needs to be \n", "considered when creating the command. Processing the cells in the path of the \n", "command object is quite similar. Each update call, dequeue the next path from \n", "the paths and move towards that cell. If the ship has reached the cell, transfer\n", "the ship to that cell and discard that cell from the path. If the path queue is \n", "empty, it means we have reached our destination. So here is the algorithm outlined \n", "in a list\n", "\n", "1. copy the command item queue to a new queue, call it nextQueue\n", "1. while there are items in the queue, loop\n", "    1. get the current command\n", "    1. currentCell = the cell this ship is on now\n", "    1. next cell = peek at the head of the path for the current command\n", "    1. if there is a ship on the next cell, enqueue that command in nextQueue and continue the loop\n", "    1. check if the ship needs a rotation to get the current cell, and process the rotation if required\n", "    1. move the ship towards the next cell\n", "    1. if the ship is in the next cell, transfer the ship to that cell.\n", "    1. if there are more paths to process, requeue the current command in nextQueue\n", "1. copy nextQueue back to command item queue\n"]}], "metadata": {"celltoolbar": "Tags", "kernelspec": {"display_name": "Python 3", "language": "python", "name": "python3"}, "language_info": {"codemirror_mode": {"name": "ipython", "version": 3}, "file_extension": ".py", "mimetype": "text/x-python", "name": "python", "nbconvert_exporter": "python", "pygments_lexer": "ipython3", "version": "3.6.12"}}, "nbformat": 4, "nbformat_minor": 4}
        </script>
    </head>
    <body>
        <div id="main">
            <div class="header">
            <div style="position: absolute; left:10px; top:5px;">
              <a href="/blog/about.html?2021-09-09 14:31:00">about</a>
              <a href="/micro/micro.html?2021-09-09 14:31:00">micro</a>
              <a href="/blogindex.html?2021-09-09 14:31:00">macro</a>
            </div>
            <h1>Deniz's Weblog</h1>
            <p style="font-family: monospace;">
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
            </p>
            </div>
            <div id="notebook-holder"></div>
            <hr/>
            <div>
              <em>Generated on 2021-09-09 14:31:00</em>
            </div>
            <p>
              Questions or comments? Please take the time to compose an email and send it to <a href="mailto:deniz.dizman@gmail.com?subject=Question/Comment">me</a>.
              I will update the relevant page with our correspondence.
            </p>
        </div>
        <script>
          var src = document.getElementById("source");
          var notebook = nb.parse(JSON.parse(src.innerText));
          var rendered = notebook.render();
          document.getElementById("notebook-holder").appendChild(rendered);
        </script>
    </body>
</html>
