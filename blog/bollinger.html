<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Deniz's personal pages</title>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1">
        <script src="/js/vendor/es5-shim.min.js"></script>
        <script src="/js/vendor/marked.min.js"></script>
        <!--script src="/js/vendor/purify.min.js"></script-->
        <script src="/js/vendor/ansi_up.min.js"></script>
        <script src="/js/vendor/prism.min.js"></script>
        <script src="/js/vendor/katex.min.js"></script>
        <script src="/js/vendor/katex-auto-render.min.js"></script>
	<script src="/js/vendor/notebook.js?_=2021-08-30 11:47:04"></script>
        <link rel="stylesheet" href="/css/vendor/katex.min.css" />
        <link rel="stylesheet" href="/css/vendor/prism.css" />
	<link rel="stylesheet" href="/css/notebook.css?2021-08-30 11:47:04" />
	<link rel="stylesheet" href="/css/nbpreview.css?2021-08-30 11:47:04" />
  <link href="https://fonts.googleapis.com/css?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,300;1,400;1,500;1,700;1,900|Roboto+Mono:300,300i,400,400i,500,500i,700,700i&amp;display=swap" rel="stylesheet">
        <script type="application/text" id="source">
          {"cells": [{"cell_type": "markdown", "metadata": {}, "source": ["# efficient calculation of bollinger bands\n", "", "2018-08-21 [#programming](/tag/programming.html) [#fintech](/tag/fintech.html)\n"]}, {"cell_type": "markdown", "metadata": {"tags": ["programming", "fintech"]}, "source": ["\n", "The Bollinger bands used in technical analysis is the +/- 2 * standard deviation of the closing price plotted on the chart.\n", "This prices are expected to fluctuate in this band 95% of the time. As with any sliding window calculation the easy way is\n", "to calculate everything each time for each window. Which usually means quadratic algorithm. A better way exists to calculate\n", "the values for standard deviations using some smart manipulations on the standard deviation formula. (to be more precise the\n", "variance formula which is the square of the standard deviation.)\n", "\n", "\n", "To the variance formula is (k = )\n", "\n", "$$ \\sum_{i=1}^{n} (price_i - mean)^2 $$\n", "\n", "expanding the quadratic term\n", "\n", "$$ \\sum_{i=1}^{n} (price_i^2 - 2 \\times price_i \\times mean + mean^2) $$\n", "\n", "extracting the last constant term independent of i\n", "\n", "\n", "$$ \\sum_{i=1}^{n} (price_i^2 - 2 \\times price_i \\times mean) + n \\times mean^2 $$\n", "\n", "extract the term independent of i from the 2nd part\n", "\n", "$$ \\sum_{i=1}^{n} (price_i^2) + \\sum_{i=1}^{n}(-2 \\times price_i) \\times mean + n \\times mean^2 $$\n", "\n", "\n", "first term and last term can be handled the way moving averages are handle. When the window slides right, add the new term\n", "remove the old term on the left. This is efficient.\n", "\n", "$$ \\sum_{i=1}^{n} price_i = total = mean \\times n $$\n", "\n", "so the middle term becomes\n", "\n", "$$ -2 \\times mean^2 \\times n $$\n", "\n", "now the second term can also be calculated using the efficient method.\n", "\n", "Here is an implementation in code for bollinger bands\n", "\n", "``` java\n", "public SuperList<BollingerBand> calculate() {\n", "    double totalAvg = 0d;\n", "    double totalSq = 0d;\n", "    int i = 0;\n", "    SuperList<BollingerBand> result = new SuperList<>();\n", "    for (Double value : values) {\n", "        totalAvg += value;\n", "        totalSq += value * value;\n", "        if (i >= PERIOD - 1) {\n", "            double avg = totalAvg / PERIOD;\n", "            double stddev = Math.sqrt((totalSq - (totalAvg*totalAvg)/PERIOD)/ PERIOD);\n", "            BollingerBand band = new BollingerBand(avg, avg + 2 * stddev, avg - 2 * stddev);\n", "            result.add(band);\n", "            totalAvg -= values.get(i - PERIOD + 1);\n", "            totalSq -= values.get(i - PERIOD + 1) * values.get(i - PERIOD + 1);\n", "        }\n", "        i++;\n", "    }\n", "    return result;\n", "}\n", "```\n"]}], "metadata": {"celltoolbar": "Tags", "kernelspec": {"display_name": "Python 3", "language": "python", "name": "python3"}, "language_info": {"codemirror_mode": {"name": "ipython", "version": 3}, "file_extension": ".py", "mimetype": "text/x-python", "name": "python", "nbconvert_exporter": "python", "pygments_lexer": "ipython3", "version": "3.6.12"}}, "nbformat": 4, "nbformat_minor": 4}
        </script>
    </head>
    <body>
        <div id="main">
            <div class="header">
            <div style="position: absolute; left:10px; top:5px;">
              <a href="/blog/about.html">about</a>
              <a href="/micro/micro.html">micro</a>
              <a href="/blogindex.html">macro</a>
            </div>
            <h1>Deniz's Weblog</h1>
            <p style="font-family: monospace;">
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
            </p>
            </div>
            <div id="notebook-holder"></div>
            <hr/>
            <div>
              <em>Generated on 2021-08-30 11:47:04</em>
            </div>
            <p>
              Questions or comments? Please take the time to compose an email and send it to <a href="mailto:deniz.dizman@gmail.com?subject=Question/Comment">me</a>.
              I will update the relevant page with our correspondence.
            </p>
        </div>
        <script>
          var src = document.getElementById("source");
          var notebook = nb.parse(JSON.parse(src.innerText));
          var rendered = notebook.render();
          document.getElementById("notebook-holder").appendChild(rendered);
        </script>
    </body>
</html>
