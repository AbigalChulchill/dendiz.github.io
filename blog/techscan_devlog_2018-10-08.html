<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Deniz's personal pages</title>
        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1">
        <script src="/js/vendor/es5-shim.min.js"></script>
        <script src="/js/vendor/marked.min.js"></script>
        <!--script src="/js/vendor/purify.min.js"></script-->
        <script src="/js/vendor/ansi_up.min.js"></script>
        <script src="/js/vendor/prism.min.js"></script>
        <script src="/js/vendor/katex.min.js"></script>
        <script src="/js/vendor/katex-auto-render.min.js"></script>
	<script src="/js/vendor/notebook.js?_=2021-09-01 14:59:45"></script>
        <link rel="stylesheet" href="/css/vendor/katex.min.css" />
        <link rel="stylesheet" href="/css/vendor/prism.css" />
	<link rel="stylesheet" href="/css/notebook.css?2021-09-01 14:59:45" />
	<link rel="stylesheet" href="/css/nbpreview.css?2021-09-01 14:59:45" />
  <link href="https://fonts.googleapis.com/css?family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,300;1,400;1,500;1,700;1,900|Roboto+Mono:300,300i,400,400i,500,500i,700,700i&amp;display=swap" rel="stylesheet">
        <script type="application/text" id="source">
          {"cells": [{"cell_type": "markdown", "metadata": {}, "source": ["# techscan devlog 2018-10-10\n", "", "2018-10-10 [#techscan](/tag/techscan.html) [#fintech](/tag/fintech.html) [#devlog](/tag/devlog.html)\n"]}, {"cell_type": "markdown", "metadata": {"tags": ["techscan", "fintech", "devlog"]}, "source": ["\n", "**summary**\n", "\n", "* stuff done in September 2018\n", "* Jenkins automation\n", "* persistence problems\n", "* return to single thread mode\n", "* scan refactoring and parameter change support\n", "* scan performance improvements\n", "* java 10 adventures\n", "* parameter recommendation tests\n", "* hybrid client developments\n", "\n", "Wow, September was a month that I would only describe as \u201cI lost my humanity\n", "and became a beast\u201d. After checking the git commit logs I see 480 new commits,\n", "touching 26410 lines for the API and Engine, which is quite a bit. There is\n", "basically too much stuff that I have done to cover in detail so I\u2019ll just have\n", "to go over the most import changes for this month.\n", "\n", "First off I want to start with the automation tasks. I was running the BFX, IEX\n", "sync tasks, scanner tasks via crontab on the test machine. This was OK for some\n", "time, but it wasn\u2019t getting notifications about failed jobs or any information\n", "about the task duration. So I moved all these periodic engine tasks to Jenkins.\n", "Another added bonus is it\u2019s way easier to manage the task pipeline (which task\n", "should run after which task, which can run in parallel) from Jenkins rather\n", "than a bunch of ad-hoc shell scripts. I also changed the development cycle from\n", "committing code to master to committing first into a development branch, and\n", "then asking Jenkins via Hubbot through slack to test and merge and push the\n", "changes. This keeps the master branch at a stable state all the time. G.\n", "requested that any pushes to the master branch of the web client repository be\n", "deployed immediately so I had to do some GitLab trickery to get that working,\n", "as GitLab doesn\u2019t allow that for unpaid accounts. But it can be done via web\n", "hooks.\n", "\n", "The current flow of crons are looking like this\n", "\n", "*lost image*\n", "\n", "Using spring boot is a MUST if you are developing with Java \u2013 the advantages it\n", "provides are countless, but it does come with it\u2019s own quirks. I had been\n", "getting \u201ctransaction manage not found \u2013 cannot remove entity\u201d errors on some of\n", "the data sync services. The solutions on the internet were all about adding a\n", "transactional annotation to the service method and people had accepted those\n", "answers. But I guess something changed along the way in spring development as\n", "they did not work for me. The solution is was to add the annotation to the\n", "repository interface. Sometimes something so simple can eat up a lot of\n", "precious development time, but it\u2019s satisfying in the end when you solve it. As\n", "I was fiddling around with this I also decided to save the response JSON from\n", "the providers instead of parsing them into domain entities and saving those.\n", "Now instead of having 1 M daily data points, I have 8 K key value items and I\n", "process them in memory. I was caching the domain objects anyways so this spares\n", "some extra load on the database.\n", "\n", "During development I wanted to get the engine results as fast as possible so I\n", "was parallelizing all the operations in the engine. I noticed along the way\n", "that \u201cparallelStream\u201d is not the answer to all of the question. I ran into\n", "cases where parallelizing would really screw up the cache, and serial\n", "processing with a good cache usage is way better (in terms of efficiency) than\n", "just using all the cores. I can get more bang for a core than I could when the\n", "processing was done in parallel. This decision was also in part due to the fact\n", "that I want to run the engine on the same machine as the API (yes, I am\n", "basically poor) and I can\u2019t have the engine hogging all the CPU and exhausting\n", "RAM. I can\u2019t also have the entire data set in memory (or most of it) and this\n", "tends to happen when threads are running at the same time. So with the serial\n", "processing using the cache in an optimal way, the scanning process takes 2.5 K\n", "seconds on a single core. Running in parallel took 600 seconds on 8 cores.\n", "\n", "A prerequisite to serialize the scanners was to improve their performance. I\n", "installed the excellent YourKit profiler trail version (which by the way is\n", "very expensive \u2013 otherwise I would buy it) and tracked down the bottle necks to\n", "unnecessary object wrapping (using my own SuperList class with convenience\n", "methods for accessing elements, like getLast(N), getTail(..), etc.) and the\n", "parsing of string to dates and vice versa. After hunting these down and\n", "refactoring the code to get rid of extra layers and work, there was a 3x\n", "increase in speed which brings the processing time to acceptable limits.\n", "\n", "An integral part of the system is the performance evaluator for scans based on\n", "past performance. I had coded this in a hurry and it was a bit disgusting, so I\n", "refactored this into it\u2019s own service. The functionality is the same but it\u2019s\n", "simplified and runs a bit faster.\n", "\n", "I hate the verbosity of Java so I thought I\u2019d look into what was going on in\n", "the Java world, which I hadn\u2019t done since the release of Java 8 and the\n", "streaming API. I found out that Java 10 was released March 2018 and finally had\n", "support for the \u201cvar\u201d keyword, which meant less verbosity in assignments. I\n", "know it\u2019s kind of trivial but I wanted to give it a go, since spring boot it\n", "supposed to support Java 10. So I went ahead and updated the development and\n", "test environments to Java 10 and compiled the code. A couple of warnings of\n", "unsafe access in spring but otherwise everything seemed OK. That is until I\n", "tried running the API. Then a lot of exceptions about Redis not being happy\n", "with something (which I don\u2019t remembers, and could not find an easy solution\n", "for), so I reverted back to 8, which is way more stable. I have long lines of\n", "code, but at least everything works correctly\n", "\n", "![](/img/1-m79Makp8mOHomhro.png)\n", "\n", "A great Idea that I had for the engine was parameter optimizations. RSI\n", "oversold is 80, but why? why not 60?\n", "\n", "I guess the guy who invented it had success with 80 and kept it as a default\n", "and now everybody uses that. But wouldn\u2019t it be great if I could figure out the\n", "optimal number by scanning the past RSI turning points? That\u2019s what parameter\n", "optimization/recommendation is about. There are a LOT of combinations to\n", "calculate so this feature has to be selective on the symbols and the parameter\n", "values that it tries. I still have to bake this idea, but I did put down a PoC\n", "service that does this.\n", "\n", "I also started with the mobile client development using PhoneGap and Framework\n", "7 with Vue.js. Vue.js is pretty amazing \u2013 at last someone has come up with a\n", "good framework for JavaScript development. I used to be a Mithril person but\n", "the lack of templating and using that m() function was a bit annoying. Also the\n", "component system in Mithril is complicated and not easy as Vue.js. Framework7\n", "looks OK\u2019ish but there are some quirks with it too. I ran into a problem with\n", "the router, that would break the back button randomly. It\u2019s surprisingly\n", "difficult to find answers to question \u2013 I guess they don\u2019t have a large\n", "community so I\u2019ll probably drop F7 in favor Vuetify.\n", "\n", "That was a long post, but I guess this is how it\u2019s gonna be if I do it monthly.\n", "I still want to do a write up about the team dynamics, and the frustration that\n", "I\u2019m having with that.\n"]}], "metadata": {"celltoolbar": "Tags", "kernelspec": {"display_name": "Python 3", "language": "python", "name": "python3"}, "language_info": {"codemirror_mode": {"name": "ipython", "version": 3}, "file_extension": ".py", "mimetype": "text/x-python", "name": "python", "nbconvert_exporter": "python", "pygments_lexer": "ipython3", "version": "3.6.13"}}, "nbformat": 4, "nbformat_minor": 4}
        </script>
    </head>
    <body>
        <div id="main">
            <div class="header">
            <div style="position: absolute; left:10px; top:5px;">
              <a href="/blog/about.html">about</a>
              <a href="/micro/micro.html">micro</a>
              <a href="/blogindex.html">macro</a>
            </div>
            <h1>Deniz's Weblog</h1>
            <p style="font-family: monospace;">
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
                <!-- a class="inverted" href="/tag/.html">/</a-->
            </p>
            </div>
            <div id="notebook-holder"></div>
            <hr/>
            <div>
              <em>Generated on 2021-09-01 14:59:45</em>
            </div>
            <p>
              Questions or comments? Please take the time to compose an email and send it to <a href="mailto:deniz.dizman@gmail.com?subject=Question/Comment">me</a>.
              I will update the relevant page with our correspondence.
            </p>
        </div>
        <script>
          var src = document.getElementById("source");
          var notebook = nb.parse(JSON.parse(src.innerText));
          var rendered = notebook.render();
          document.getElementById("notebook-holder").appendChild(rendered);
        </script>
    </body>
</html>
